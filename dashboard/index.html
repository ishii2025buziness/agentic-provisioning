<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X-Collector | Management Console</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
        }

        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .accent-glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }
    </style>
</head>

<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1
                    class="text-3xl font-bold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-500">
                    Autonomous X-Collector</h1>
                <p class="text-slate-400 mt-1">Hetzner Live Management Console</p>
            </div>
            <div id="status-badge" class="px-4 py-2 rounded-full glass flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-slate-500 pulse"></div>
                <span class="font-semibold text-sm">LOADING...</span>
            </div>
        </header>

        <!-- Stats Bar -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="glass p-6 rounded-2xl border-l-4 border-indigo-500">
                <div class="text-xs text-slate-400 uppercase font-bold mb-1">Total Items in Vault</div>
                <div id="stat-vault" class="text-3xl font-bold">0</div>
            </div>
            <div class="glass p-6 rounded-2xl border-l-4 border-emerald-500">
                <div class="text-xs text-slate-400 uppercase font-bold mb-1">Last Run Status</div>
                <div id="stat-last-run" class="text-sm font-semibold text-emerald-400">Never executed</div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Control Panel -->
            <section class="lg:col-span-1 space-y-6">
                <!-- Power Controls -->
                <div class="glass p-6 rounded-2xl">
                    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <i data-lucide="zap" class="w-5 h-5 text-yellow-400"></i> Control
                    </h2>
                    <div class="flex gap-3">
                        <button onclick="control('start')"
                            class="flex-1 bg-blue-600 hover:bg-blue-500 py-3 rounded-xl font-bold transition-all transform hover:scale-105">START</button>
                        <button onclick="control('stop')"
                            class="flex-1 bg-slate-700 hover:bg-slate-600 py-3 rounded-xl font-bold transition-all transform hover:scale-105">STOP</button>
                    </div>
                </div>

                <!-- Collection Mission -->
                <div class="glass p-6 rounded-2xl">
                    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <i data-lucide="target" class="w-5 h-5 text-red-400"></i> Collection Mission
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="text-xs text-slate-400 uppercase font-bold">Query / Keywords</label>
                            <input id="config-query" type="text"
                                class="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 mt-1 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 uppercase font-bold">Mode</label>
                            <select id="config-mode"
                                class="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 mt-1 outline-none">
                                <option value="search">Search (Query)</option>
                                <option value="user">User (Timeline)</option>
                                <option value="list">List (Bulk)</option>
                                <option value="profile">Profile (Meta)</option>
                            </select>
                        </div>
                        <button onclick="saveConfig()"
                            class="w-full bg-gradient-to-r from-indigo-600 to-blue-600 py-3 rounded-xl font-bold accent-glow tracking-wide">UPDATE
                            MISSION</button>
                    </div>
                </div>
            </section>

            <!-- Data Feed -->
            <section class="lg:col-span-2 glass rounded-2xl overflow-hidden flex flex-col">
                <div class="p-6 border-b border-white/5 flex justify-between items-center">
                    <h2 class="text-lg font-semibold flex items-center gap-2">
                        <i data-lucide="layout-list" class="w-5 h-5 text-blue-400"></i> Live Data Feed
                    </h2>
                    <button onclick="fetchData()" class="text-sm text-blue-400 hover:text-blue-300">Refresh
                        Data</button>
                </div>
                <div id="data-list" class="p-6 space-y-4 overflow-y-auto max-h-[600px] custom-scrollbar">
                    <!-- Data items will populate here -->
                </div>
            </section>
        </div>
    </div>

    <script>
        async function updateStatus() {
            const res = await fetch('/api/status');
            const data = await res.json();

            const badge = document.getElementById('status-badge');
            const dot = badge.querySelector('div');
            const label = badge.querySelector('span');

            label.innerText = (data.status || 'unknown').toUpperCase();
            if (data.status === 'online') {
                dot.className = "w-3 h-3 rounded-full bg-green-500 accent-glow";
                badge.classList.add('border-green-500/30');
            } else {
                dot.className = "w-3 h-3 rounded-full bg-red-500";
                badge.classList.remove('border-green-500/30');
            }

            document.getElementById('config-query').value = data.config.mission.query;
            document.getElementById('config-mode').value = data.config.mission.mode;
            document.getElementById('stat-vault').innerText = (data.vaultSize || 0).toLocaleString();
            document.getElementById('stat-last-run').innerText = data.config.settings?.last_run ? new Date(data.config.settings.last_run).toLocaleString() : 'Ready to start';
        }

        async function saveConfig() {
            const query = document.getElementById('config-query').value;
            const mode = document.getElementById('config-mode').value;

            const res = await fetch('/api/status');
            const current = await res.json();

            const newConfig = {
                ...current.config,
                mission: { ...current.config.mission, query, mode }
            };

            await fetch('/api/config', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(newConfig)
            });
            alert("Mission Updated!");
        }

        async function control(action) {
            await fetch('/api/control', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action })
            });
            setTimeout(updateStatus, 1000);
        }

        async function fetchData() {
            const res = await fetch('/api/data');
            const items = await res.json();
            const list = document.getElementById('data-list');
            list.innerHTML = items.length ? '' : '<p class="text-center text-slate-500 mt-10">No data collected yet.</p>';

            items.forEach(item => {
                const el = document.createElement('div');
                el.className = 'glass p-4 rounded-xl border-l-4 border-blue-500 hover:bg-white/5 transition-colors';
                el.innerHTML = `
                    <div class="flex justify-between mb-2">
                        <span class="font-bold text-blue-400">@${item.user?.screen_name || 'unknown'}</span>
                        <span class="text-xs text-slate-500">${new Date(item.created_at || Date.now()).toLocaleString()}</span>
                    </div>
                    <p class="text-sm leading-relaxed">${item.full_text || item.text || JSON.stringify(item).substring(0, 100)}</p>
                `;
                list.appendChild(el);
            });
        }

        lucide.createIcons();
        setInterval(updateStatus, 5000);
        updateStatus();
        fetchData();
    </script>
</body>

</html>